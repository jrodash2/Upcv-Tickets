{% extends 'empleados/base.html' %}
{% load static %}



{% block content %}
<div class="page-body">
  <div class="container-fluid">


   <!-- Segunda fila: Contratos -->
<div class="row mt-4">

  <!-- Gráfica: Contratos vigentes (Donut) -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Contratos Vigentes</h5>
      </div>
      <div class="card-body">
        <div id="contratosVigentesChart"></div>
      </div>
    </div>
  </div>

  <!-- Gráfica: Contratos por Año (Barra) -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Contratos por Año</h5>
      </div>
      <div class="card-body">
        <div id="contratosPorAnioChart"></div>
      </div>
    </div>
  </div>
  </div>
  </div>
  </div>


<!-- Script de ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
// Contratos Vigentes vs No Vigentes (Donut)
const optionsContratosVigentes = {
  chart: {
    type: 'donut',
    height: 350
  },
  series: [{{ datos_empleados.contratos_vigentes }}, {{ datos_empleados.contratos_no_vigentes }}],
  labels: ['Vigentes', 'No Vigentes'],
  colors: ['#0c4a6e', '#4cb8a4'],
  tooltip: {
    y: {
      formatter: val => val + ' contratos'
    }
  }
};
new ApexCharts(document.querySelector("#contratosVigentesChart"), optionsContratosVigentes).render();

// Contratos por Año (Bar Chart)
const contratosPorAnio = {{ contratos_por_anio|safe }};
const contratosLabels = contratosPorAnio.map(item => item.anio);
const contratosData = contratosPorAnio.map(item => item.total);

const optionsContratosAnio = {
  chart: {
    type: 'bar',
    height: 350,
    toolbar: { show: false }
  },
  series: [{
    name: 'Contratos',
    data: contratosData
  }],
  xaxis: {
    categories: contratosLabels
  },
  colors: ['#0c4a6e'],
  tooltip: {
    y: {
      formatter: val => val + ' contratos'
    }
  }
};

new ApexCharts(document.querySelector("#contratosPorAnioChart"), optionsContratosAnio).render();

</script>

{% endblock %}
