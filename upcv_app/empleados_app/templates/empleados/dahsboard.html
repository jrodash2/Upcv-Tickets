{% extends 'empleados/base.html' %}
{% load static %}

{% block title %}Dashboard Empleados{% endblock %}

{% block content %}
<div class="page-body">
  <div class="container-fluid">
    <div class="page-title">
      <div class="row">
        <div class="col-6">
          <h4>Empleados Activos e Inactivos</h4>
        </div>
      </div>
    </div>

    <!-- Dos gr치ficas a la par -->
    <div class="row mt-4">

      <!-- Gr치fica 1: Pie Chart Estado -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Estado de los Empleados</h5>
          </div>
          <div class="card-body">
            <div id="empleadosChart"></div>
          </div>
        </div>
      </div>

      <!-- Gr치fica 2: Barras por A침o -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Empleados Activos por A침o de Ingreso</h5>
          </div>
          <div class="card-body">
            <div id="empleadosPorAnioChart"></div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Script de ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Gr치fica 1: Estado de los empleados (Pie Chart)
    const optionsEstado = {
      chart: {
        type: 'pie',
        height: 350,
      },
      series: [{{ datos_empleados.activos }}, {{ datos_empleados.inactivos }}],
      labels: ['Activos', 'Inactivos'],
      colors: ['#0c4261ff', '#1e7d94'],
      tooltip: {
        y: {
          formatter: function (val) {
            return val + " empleados";
          }
        }
      }
    };

    const chartEstado = new ApexCharts(document.querySelector("#empleadosChart"), optionsEstado);
    chartEstado.render();
// Gr치fica 2: Activos por a침o (Bar Chart)
const activosPorAnio = {{ activos_por_anio|safe }};
const labelsAnios = activosPorAnio.map(item => item.anio);
const dataAnios = activosPorAnio.map(item => item.total);

const optionsAnio = {
  chart: {
    type: 'bar',
    height: 350,
    toolbar: {
      show: false  // 游댮 Esto oculta las opciones de descarga
    }
  },
  series: [{
    name: 'Activos',
    data: dataAnios
  }],
  xaxis: {
    categories: labelsAnios,
    title: {
      text: ''
    }
  },
  yaxis: {
    title: {
      text: 'Cantidad de Empleados'
    }
  },
  colors: ['#0c4261ff'],
  tooltip: {
    y: {
      formatter: val => val + ' empleados'
    }
  }
};

const chartAnio = new ApexCharts(document.querySelector("#empleadosPorAnioChart"), optionsAnio);
chartAnio.render();

  });
</script>
{% endblock %}
