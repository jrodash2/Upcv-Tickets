{% extends 'empleados/base.html' %}
{% load static %}

{% block content %}
<!-- Fuentes y scripts -->
<link href="{% static 'fonts/Montserrat-Regular.ttf' %}" rel="stylesheet">
<link href="{% static 'fonts/Montserrat-Bold.ttf' %}" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.min.js"></script>

<style>
  @font-face {
    font-family: 'Altivo Black';
    src: url("{% static 'assets/fonts/altivo-black.ttf' %}") format('truetype');
  }

  @font-face {
    font-family: 'Altivo Medium';
    src: url("{% static 'assets/fonts/35172.otf' %}") format('truetype');
  }

 

  .t {
    font-family: 'Altivo Black', sans-serif;
    font-size: clamp(41px, 9vw, 43px);
    padding-left: 0.7em;
  }

  .t2 {
    font-family: 'Altivo Medium', sans-serif;
    font-size: clamp(22px, 6vw, 28px);
    padding-left: 0.7em;
  }

  .t3 {
    font-family: 'Altivo Medium', sans-serif;
    color: white;
    font-size: clamp(12px, 1vw, 22px);
    padding-left: 0.7em;
  }

   .t4 {
    font-family: 'Altivo Black', sans-serif;
    font-size: clamp(22px, 7.5vw, 31px);
    padding-left: 0.7em;
  }

   .t5 {
    font-family: 'Altivo Black', sans-serif;
    font-size: clamp(31px, 7.5vw, 31px);
    padding-left: 0.7em;
  }

  .gafete-wrapper {
    width: 100%;
    max-width: 645px;
    aspect-ratio: 645 / 1004;
    margin-bottom: 20px;
    position: relative;
  }

  .gafete-card {
    width: 100%;
    height: 100%;
    position: relative;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
  }

  .card-body {
    background-image: url('{% static "assets/svg/empleado.svg" %}');
  }

  .card2-body {
    background-image: url('{% static "assets/svg/empleado2.svg" %}');
  }

  .gafete-img {
    position: absolute;
    top: 11%;
    left: 17%;
    width: 45%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 50%;
    z-index: 5;
  }

  .qr-code {
  position: absolute;
  top: 52%;
  left: 65%;
  width: 30%;               /* mantiene su tama침o relativo */
  aspect-ratio: 1 / 1;
  z-index: 10;
}

.qr-code img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Media Query para m칩viles */
@media (max-width: 768px) {
  .qr-code {
    width: 33%;     /* 游대 Aumenta o reduce seg칰n necesites */
    top: 52%;
    left: 65%;      /* 游대 Mueve si se sale del 치rea visible */
  }
}


.logotipos {
  position: absolute;
  bottom: 9%;
  left: 5%;
  width: 95%;
  display: flex;
  flex-wrap: wrap; /* permite que se ajusten si no caben en una fila */
  justify-content: center; /* centrado en todas las resoluciones */
  align-items: center;
  gap: 1rem;
  z-index: 5;
}

.logotipos img {
  max-width: 90%;         /* se ajusta al contenedor pero no lo sobrepasa */
  max-height: 90px;       /* mantiene el tama침o grande como pediste */
  height: auto;
  object-fit: contain;
}

@media (max-width: 768px) {
  .logotipos {
    bottom: 8.5%;
    flex-direction: row;  /* permite fila en m칩viles tambi칠n */
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;  /* menos espacio entre logos */
  }

  .logotipos img {
    max-width: 158px;  /* mantiene el tama침o grande pero razonable en m칩viles */
  }
}



}

  svg text {
    font-size: clamp(14px, 2.5vw, 32px);
  }

  .gafetes-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
  }

  #download-gafete-button,
  #download-gafete-2-button {
    padding: 12px 25px;
    background-color: #180269;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 18px;
    cursor: pointer;
    margin-top: 20px;
  }

  #download-gafete-button:hover,
  #download-gafete-2-button:hover {
    background-color: #7445a0;
  }

  @media print {
    body {
      background-color: white;
      margin: 0;
      padding: 0;
    }

    .page-body, .container-fluid, .edit-profile {
      width: 100%;
      height: auto;
    }

    button, .logotipos {
      display: none;
    }

    .gafete-wrapper {
      page-break-after: always;
    }
  }
</style>

<div class="page-body">
  <div class="container-fluid">
    <div class="edit-profile">
      <div class="row">
        <div class="gafetes-container">

          <!-- Gafete Parte 1 -->
          <div class="gafete-wrapper">
            <div class="gafete-card card-body" id="gafete">
              <div class="t3" style="position:absolute; top: 2%; left: 7%;">
                {{ configuracion.nombre_institucion }}
              </div>

              {% if empleado.imagen %}
                <img src="{{ empleado.imagen.url }}" alt="Imagen del empleado" class="gafete-img">
              {% else %}
                <p>No hay imagen cargada</p>
              {% endif %}

              <svg viewBox="0 0 600 1004" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
                <text x="50" y="485" class="t2" fill="#182b55">{{ empleado.nombres }}</text>
                <text x="50" y="522" class="t" fill="#182b55">{{ empleado.apellidos }}</text>
                <text x="50" y="715" class="t2" fill="#182b55">{{ empleado.tipoc }}</text>

                {% if empleado.dcargo %}
                  <text x="50" y="759" class="t4" fill="#182b55">{{ empleado.dcargo }}</text>
                  {% if empleado.dcargo2 %}
                    <text x="50" y="795" class="t5" fill="#182b55">{{ empleado.dcargo2 }}</text>
                  {% endif %}
                {% endif %}

                <text x="50" y="605" class="t2" fill="#182b55">No. de Identificaci칩n:</text>
                <text x="50" y="640" class="t4" fill="#182b55">DPI: {{ empleado.dpi }}</text>

               <text x="180" y="985" class="t2" fill="#ffffff">
 {% if not request.user.is_authenticated %}
                Empleado: {% if empleado.tiene_contrato_activo %}Activo{% else %}Inactivo{% endif %}
                {% endif %}
</text>

              </svg>

              {% if empleado.qr_code %}
                <div class="qr-code">
                  <img src="{{ empleado.qr_code.url }}" alt="C칩digo QR">
                </div>
              {% endif %}

              <div class="logotipos">
                {% if configuracion.logotipo %}
                  <div class="logotipo">
                    <img src="{{ configuracion.logotipo.url }}" alt="Logotipo 1">
                  </div>
                {% endif %}
                {% if configuracion.logotipo2 %}
                  <div class="logotipo">
                    <img src="{{ configuracion.logotipo2.url }}" alt="Logotipo 2">
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Gafete Parte 2 -->
          <div class="gafete-wrapper">
            <div class="gafete-card card2-body" id="gafete-2">
              <svg viewBox="0 0 600 1004" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
                <text x="50%" y="910" class="t5" text-anchor="middle" fill="#182b55">{% if empleado.contrato_activo %}
                  V치lido hasta el  {{ empleado.contrato_activo.fecha_vencimiento|date:"j \\d\\e F \\d\\e Y" }} {% endif %}
                </text>
              </svg>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

{% if user.is_authenticated %}
  <div style="display: flex; gap: 10px; justify-content: center;">
    <button id="download-gafete-button" onclick="downloadGafete()">Descargar Parte 1</button>
    <button id="download-gafete-2-button" onclick="downloadGafete2()">Descargar Parte 2</button>
  </div>
{% endif %}

<script>
  function downloadGafete() {
    html2canvas(document.getElementById('gafete'), {
      useCORS: true,
      scale: 4,
      backgroundColor: null
    }).then(function(canvas) {
      var link = document.createElement('a');
      link.href = canvas.toDataURL('image/jpeg');
      link.download = 'gafete.jpg';
      link.click();
    });
  }

  function downloadGafete2() {
    html2canvas(document.getElementById('gafete-2'), {
      useCORS: true,
      scale: 4,
      backgroundColor: null
    }).then(function(canvas) {
      var link = document.createElement('a');
      link.href = canvas.toDataURL('image/jpeg');
      link.download = 'gafete-2.jpg';
      link.click();
    });
  }
</script>
{% endblock %}
