{% extends 'scompras/base.html' %}
{% load static %}

{% block content %}
<div class="page-body">
  <div class="container-fluid">
    
    <div class="row mt-4">
      <div class="col-md-12">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-gradient d-flex justify-content-between align-items-center"
               style="background: linear-gradient(90deg, #0c4a6e 0%, #38bdf8 100%);">
            <h4 class="mb-0 text-white">
              Tendencia de Solicitudes por Mes y Año
            </h4>
            <span class="badge bg-white text-black px-3 py-2" style="font-size: 0.9rem;">
              {{ seccion.nombre|upper }}
            </span>
          </div>
          <div class="card-body">
            <div id="solicitudesMesAnioChart"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const data = {{ solicitudes_por_anio_mes|safe }};

  // Validar que haya datos
  if (!data || data.length === 0) {
    document.querySelector("#solicitudesMesAnioChart").innerHTML = "<p class='text-center text-muted'>No hay datos disponibles</p>";
    return;
  }

  // Etiquetas tipo "2025-01", "2025-02", etc.
  const categorias = data.map(item => {
    const mes = String(item.mes).padStart(2, '0');
    return `${item.anio}-${mes}`;
  });

  const totales = data.map(item => item.total);

  const options = {
    chart: {
      type: 'area',
      height: 380,
      toolbar: { show: false },
      zoom: { enabled: false }
    },
    series: [{
      name: 'Solicitudes registradas',
      data: totales
    }],
    xaxis: {
      categories: categorias,
      title: { text: 'Mes / Año' },
      labels: {
        rotate: -45,
        style: { fontSize: '12px', colors: '#374151' }
      },
      axisBorder: { color: '#d1d5db' },
      axisTicks: { color: '#d1d5db' }
    },
    yaxis: {
      title: { text: 'Cantidad de Solicitudes' },
      labels: { style: { fontSize: '13px', colors: '#374151' } }
    },
    stroke: {
      curve: 'smooth',
      width: 3,
      colors: ['#0ea5e9']
    },
    fill: {
      type: 'gradient',
      gradient: {
        shadeIntensity: 1,
        opacityFrom: 0.5,
        opacityTo: 0.1,
        colorStops: [
          { offset: 0, color: '#38bdf8', opacity: 0.45 },
          { offset: 100, color: '#0c4a6e', opacity: 0.05 }
        ]
      }
    },
    markers: {
      size: 4,
      colors: ['#fff'],
      strokeColors: '#0ea5e9',
      strokeWidth: 3,
      hover: { size: 6 }
    },
    dataLabels: {
      enabled: true,
      style: { colors: ['#0c4a6e'], fontWeight: 'bold' },
      background: { enabled: false }
    },
    grid: { borderColor: '#e5e7eb' },
    tooltip: {
      theme: 'light',
      x: { formatter: val => val },
      y: { formatter: val => val + " solicitudes" }
    },
    colors: ['#0ea5e9']
  };

  const chart = new ApexCharts(document.querySelector("#solicitudesMesAnioChart"), options);
  chart.render();
});
</script>



<style>
#solicitudesMesAnioChart {
  max-width: 100%;
  height: 400px;
  margin: 0 auto;
}
</style>
{% endblock %}
{% endblock %}
