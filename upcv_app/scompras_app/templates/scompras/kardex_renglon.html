{% extends 'scompras/base.html' %}
{% load static %}

{% block content %}

<!-- Cargar jQuery -->
<script src="{% static 'assets/js/jquery.min.js' %}"></script>
<!-- Cargar DataTable js -->
<script src="{% static 'assets/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/datatable.custom.js' %}"></script>

<div class="page-body">
  <div class="container-fluid">
    <div class="page-title d-flex justify-content-between align-items-center">
      <div>
        <h4>Kardex del rengl√≥n {{ renglon.codigo_renglon }} ({{ renglon.presupuesto_anual.anio }})</h4>
        <p class="text-muted mb-0">Historial contable no editable.</p>
      </div>
      <a class="btn btn-light" href="{% url 'scompras:presupuesto_anual_detalle' renglon.presupuesto_anual.id %}">
        Volver al presupuesto
      </a>
    </div>

    <div class="card mb-3">
      <div class="card-body">
        <form method="get" class="row g-2 align-items-end">
          <div class="col-sm-4">
            <label class="form-label">Filtrar por tipo</label>
            <select name="tipo" class="form-select">
              <option value="">Todos</option>
              {% for value, label in tipos %}
                <option value="{{ value }}" {% if value == tipo_filtrado %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-sm-2">
            <button type="submit" class="btn btn-primary">Filtrar</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Movimientos</h5>
      </div>

      <div class="card-body">
        <div class="table-responsive custom-scrollbar">
          <table class="display" id="basic-9">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Monto</th>
                <th>Saldo anterior</th>
                <th>Saldo nuevo</th>
                <th>Solicitud</th>
                <th>Referencia</th>
              </tr>
            </thead>

            <tbody>
              {% for movimiento in movimientos %}
              <tr>
                <td>{{ movimiento.fecha|date:'Y-m-d H:i' }}</td>
                <td>{{ movimiento.get_tipo_display }}</td>
                <td class="text-end">{{ movimiento.monto }}</td>
                <td class="text-end">{{ movimiento.saldo_anterior }}</td>
                <td class="text-end">{{ movimiento.saldo_nuevo }}</td>
                <td>
                  {% if movimiento.solicitud %}
                    <a href="{% url 'scompras:detalle_solicitud' movimiento.solicitud.id %}">
                      Solicitud {{ movimiento.solicitud.codigo_correlativo|default:movimiento.solicitud.id }}
                    </a>
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td>{{ movimiento.referencia|default:'-' }}</td>
              </tr>
              {% endfor %}
            </tbody>

            <tfoot>
              <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Monto</th>
                <th>Saldo anterior</th>
                <th>Saldo nuevo</th>
                <th>Solicitud</th>
                <th>Referencia</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
