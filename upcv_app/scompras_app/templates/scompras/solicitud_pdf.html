{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Solicitud de Compra</title>

  <style>
    @page {
      size: letter;
      margin: 18px;

      @frame content_frame {
        left: 18px; right: 18px;
        top: 18px; bottom: 140px;  /* ‚úÖ reserva espacio para el footer */
      }

      @frame footer_frame {
        left: 18px; right: 18px;
        bottom: 18px;
        height: 120px;              /* ‚úÖ alto del pie */
        -pdf-frame-content: footer_content; /* ‚úÖ este ID se renderiza fijo abajo */
      }
    }

    body{
      font-family: Arial, sans-serif;
      font-size: 11px;
      margin: 0;
      color:#111;
    }

    /* ====== CABECERA ====== */
    .hdr{
      width:100%;
      border-collapse:collapse;
      margin-bottom:6px;
    }
    .hdr td{ vertical-align:middle; padding:0; }

    .logos{
      width:62%;
      white-space:nowrap;
    }
    .logos img{
      height:78px;
      width:auto;
      margin-right:8px;
      vertical-align:middle;
    }

    .titlebox{
      width:38%;
      border:1px solid #444;
      padding:6px 8px;
      font-size:10px;
    }
    .titlebox .t{
      font-size:12px;
      font-weight:bold;
      text-align:center;
      margin:0 0 4px 0;
      letter-spacing:.3px;
    }
    .titlebox p{ margin:0; line-height:1.25; }

    .info{
      width:100%;
      border-collapse:collapse;
      margin-bottom:10px;
      table-layout:fixed;
    }

    .info td{
      border:1px solid #444;
      padding:7px 10px;
      font-size:10px;
      line-height:1.35;
      vertical-align:top;
    }

    .info .box-title{
      display:block;
      font-weight:bold;
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:.3px;
      color:#111;
      margin-bottom:4px;
      padding:3px 6px;
      border:1px solid #bbb;
      background:#f3f3f3;
    }

    .info .row{ margin:0; padding:0; }

    .info .label{
      font-weight:bold;
      display:inline-block;
      width:78px;            /* ancho fijo para alinear */
      color:#222;
    }

    .info .value{ color:#111; }

    .label{ font-weight:bold; display:inline-block; width:74px; }

    /* ====== TEXTO + TABLA ====== */
    .ptext{
      margin:0 0 6px;
      font-size:10px;
      line-height:1.25;
    }

    .table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      margin-bottom:8px;
    }

    .table col{ border:0; }

    .table th, .table td{
      border:1px solid #8c8c8c;
      padding:4px 5px;
      font-size:9px;
      line-height:1.25;
      vertical-align:top;
      -pdf-keep-in-frame-mode: overflow;
    }

    .table th{
      background:#f1f3f5;
      text-align:center;
      font-weight:bold;
      white-space:normal;
      word-break:normal;
      word-wrap:break-word;
    }

    .table .td-code{
      white-space:nowrap;
      word-break:normal;
      font-size:8.5px;
    }

    .table .text-wrap{
      white-space:normal;
      word-wrap:break-word;
      overflow-wrap:break-word;
      word-break:break-word;
    }

    .anexos{
      margin-top:8px;
      font-size:9px;
    }

    .anexos h4{
      margin:0 0 6px;
      font-size:10px;
    }

    .anexo-item{
      border:1px solid #8c8c8c;
      padding:6px;
      margin-bottom:5px;
    }

    .center{ text-align:center; }

    /* ===== Anchos POR CLASE (m√°s estable para xhtml2pdf) ===== */
    .w-cant{ width:5%;  }
    .w-reng{ width:5%;  }
    .w-cod { width:9%;  }
    .w-nom { width:12%; }
    .w-car { width:28%; }
    .w-esp { width:10%; }
    .w-pre { width:9%;  }
    .w-cup { width:12%; }
    .w-cop { width:10%; }

    /* ======================================================
       ‚úÖ FOOTER FIJO (mover imagen con X/Y usando m√°rgenes)
       ====================================================== */
    #footer_content{ /* contenedor del pie */ }

    #img-movible{
      width: 720px;
      height: auto;
      margin-left: 35px; /* üëà X */
      margin-top: 0px;   /* üëà Y dentro del footer */
      display:block;
    }
  </style>
</head>

<body>

  <!-- ====== ENCABEZADO ====== -->
  <table class="hdr">
    <tr>
      <td class="logos">
        <img src="{{ institucion.logo2.url }}" alt="Logo 2" />
        <img src="{{ institucion.logo.url }}" alt="Logo 1" />
      </td>
      <td>
        <div class="titlebox">
          <div class="t">SOLICITUD DE COMPRA</div>
          <p><strong>C√≥digo:</strong> {{ solicitud.codigo_correlativo }}</p>
          <p><strong>Fecha:</strong> {{ solicitud.fecha_solicitud|date:"d M Y" }}</p>
        </div>
      </td>
    </tr>
  </table>

  <table class="info">
    <tr>
      <td width="33%">
        <span class="box-title">Solicitante</span>

        <div class="row">
          <span class="label">Solicita:</span>
          <span class="value">
            {% if solicitud.seccion and solicitud.seccion.firmante_nombre %}
              {{ solicitud.seccion.firmante_nombre }}
            {% else %}
              Firmante no configurado
            {% endif %}
          </span>
        </div>

        <div class="row">
          <span class="label">Cargo:</span>
          <span class="value">
            {% if solicitud.seccion and solicitud.seccion.firmante_cargo %}
              {{ solicitud.seccion.firmante_cargo }}
            {% else %}
              Cargo no configurado
            {% endif %}
          </span>
        </div>
      </td>

      <td width="34%">
        <span class="box-title">Unidad solicitante</span>

        {% if solicitud.seccion.departamento.nombre == solicitud.seccion.nombre %}
          <div class="row">
            <span class="label"></span>
            <span class="value">{{ solicitud.seccion.nombre }}</span>
          </div>
        {% else %}
          <div class="row">
            <span class="label"></span>
            <span class="value">{{ solicitud.seccion.departamento.nombre }}</span>
          </div>

          <div class="row">
            <span class="label"></span>
            <span class="value">{{ solicitud.seccion.nombre }}</span>
          </div>
        {% endif %}
      </td>

      <td width="33%">
        <span class="box-title">Clasificaci√≥n presupuestaria</span>

        <div class="row">
          <span class="label">Producto:</span>
          <span class="value">{{ solicitud.producto.nombre }}</span>
        </div>

        <div class="row">
          <span class="label">Subprod.:</span>
          <span class="value">{{ solicitud.subproducto.nombre }}</span>
        </div>
      </td>
    </tr>
  </table>
 <p class="ptext">
    Por este medio se solicita al Departamento Administrativo Financiero se sirva efectuar la compra de lo que a continuaci√≥n se detalla:
  </p>

  {% if filas_layout %}
    <table class="table">
      <colgroup>
        <col class="w-cant" />
        <col class="w-reng" />
        <col class="w-nom" />
        <col class="w-car" />
        <col class="w-esp" />
        <col class="w-pre" />
        <col class="w-cup" />
        <col class="w-cod" />
        <col class="w-cop" />
      </colgroup>
      <thead>
        <tr>
          <th width="5%">Cantidad</th>
          <th width="5%">Rengl√≥n</th>
          <th width="12%">Nombre</th>
          <th width="28%">Caracter√≠sticas</th>
          <th width="10%">Caract. Especial</th>
          <th width="9%">Presentaci√≥n</th>
          <th width="12%">Cant. Unidad<br>Presentaci√≥n</th>
          <th width="9%">C√≥digo Insumo</th>
          <th width="10%">C√≥digo Presentaci√≥n</th>
        </tr>
      </thead>
      <tbody>
        {% for fila in filas_layout %}
          <tr>
            <td class="center">{{ fila.cantidad }}</td>
            <td class="center">{{ fila.renglon }}</td>
            <td class="text-wrap">{{ fila.nombre }}</td>

            <td class="text-wrap">
              {% if fila.car_texto_tabla %}{{ fila.car_texto_tabla }}{% else %}-{% endif %}
            </td>

            <td class="text-wrap">
              {% if fila.esp_texto_tabla %}{{ fila.esp_texto_tabla }}{% else %}-{% endif %}
            </td>

            <td class="center">{{ fila.presentacion }}</td>
            <td class="center">{{ fila.cant_unidad_presentacion }}</td>
            <td class="center td-code">{{ fila.codigo_insumo }}</td>
            <td class="center td-code">{{ fila.codigo_presentacion }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <table class="table">
      <tbody>
        <tr>
          <td class="center">No hay insumos ni servicios agregados.</td>
        </tr>
      </tbody>
    </table>
  {% endif %}

  {% if anexos_texto %}
    <div class="anexos">
      <h4>Cuadro de Caracter√≠sticas Especiales:</h4>
      {% for anexo in anexos_texto %}
        <div class="anexo-item">
          <span class="text-wrap">{{ anexo.texto_completo }}</span>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div id="justificacion">
    <strong>Justificaci√≥n:</strong> {{ solicitud.descripcion }}
  </div>

  <div id="footer_content">
    <img id="img-movible" src="{% static 'assets/images/login/firmas.png' %}" alt="Firmas">
  </div>

</body>
</html>